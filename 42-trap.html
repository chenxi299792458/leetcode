<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1"
    />
    <meta content="telephone=no" name="format-detection" />
    <meta content="email=no" name="format-detection" />
    <meta content="yes" name="apple-mobile-web-app-capable" />
    <meta content="black" name="apple-mobile-web-app-status-bar-style" />
    <title>weiCC</title>
  </head>

  <body></body>

  <script>
    var nums = [0, 1, 0, 2, 1, 0, 1, 3, 2, 1, 2, 1];

    var calcRoom = (nums, start, end) => {
      let height = Math.min(nums[start], nums[end]);
      let sum = 0;
      for (let i = start + 1; i < end; i++) {
        sum += (height - nums[i]);
      }
      return sum;
    };

    var trap = function(height) {
      let sum = 0;
      for (let i = 0; i <= height.length; ) {
        let startHeight = height[i];
        if (startHeight === 0) {
          i++;
          continue;
        }
        let end = -1;
        for (let j = i + 1; j < height.length; j++) {
          const element = height[j];
          if (element === 0) {
            continue;
          }
          if (end == -1 || height[end] < element) {
            end = j;
          }
          if (height[end] >= startHeight) {
            break;
          }
        }
        if (end === -1) {
          break;
        }
        if (end - i > 1) {
          sum += calcRoom(height, i, end);
        }
        i = end;
      }
      return sum;
    };

    console.log(trap(nums));
  </script>
</html>
